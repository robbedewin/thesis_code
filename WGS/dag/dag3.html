<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snakemake Workflow Visualization</title>
    <style>
        .node circle {
            fill: #999;
            stroke: #555;
            stroke-width: 1.5px;
        }

        .node text {
            font: 12px sans-serif;
            pointer-events: none;
            text-anchor: middle;
        }

        .link {
            fill: none;
            stroke: #555;
            stroke-width: 1.5px;
        }
    </style>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <svg width="960" height="600"></svg>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const width = 960, height = 600;

            const svg = d3.select("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(40,0)");

            const tree = d3.tree().size([height, width - 160]);

            d3.json("dag_py_converted.json").then(function(data) {
                const idToNode = {};
                data.nodes.forEach(node => {
                    idToNode[node.id] = { id: node.id, label: node.label, children: [] };
                });
                data.links.forEach(link => {
                    idToNode[link.source].children.push(idToNode[link.target]);
                });

                const root = d3.hierarchy(idToNode["0"]);

                tree(root);

                const link = svg.selectAll(".link")
                    .data(root.links())
                    .enter().append("path")
                    .attr("class", "link")
                    .attr("d", d3.linkHorizontal()
                        .x(d => d.y)
                        .y(d => d.x));

                const node = svg.selectAll(".node")
                    .data(root.descendants())
                    .enter().append("g")
                    .attr("class", d => "node" + (d.children ? " node--internal" : " node--leaf"))
                    .attr("transform", d => `translate(${d.y},${d.x})`);

                node.append("circle")
                    .attr("r", 2.5);

                node.append("text")
                    .attr("dy", 3)
                    .attr("x", d => d.children ? -8 : 8)
                    .style("text-anchor", d => d.children ? "end" : "start")
                    .text(d => d.data.label);
            });
        });
    </script>
</body>
</html>
